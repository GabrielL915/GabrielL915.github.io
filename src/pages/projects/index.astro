---
import { themeConfig } from '~/.config'
import LayoutDefault from '~/layouts/LayoutDefault.astro'
import { getProjectCategories, getPathFromCategory } from '~/utils/index'

const { translate: t } = Astro.locals
const categoryMap = await getProjectCategories()

const list = getListFromMap(categoryMap)

function getListFromMap(map: typeof categoryMap) {
  return Array.from(map).map(([key, value]) => ({
    title: key,
    href: `/project-categories/${getPathFromCategory(key, themeConfig.site.categoryMap)}`,
    projects: value, // lista de projetos para essa categoria
    size: t('projects_count', value.length),
  }))
}
---

<LayoutDefault>
  <section>
    <h2 class="post-title">{t('Project Categories')}</h2>
    <ul class="pl-6" flex="~ col gap-4">
      {
        list.map(({ title, href, projects }) => (
          <li>
            <h3 class="post-title">
              <a href={href}># {title}</a>
            </h3>
            <ul>
              {projects.map(project => (
                <li>
                  <!-- Gerar link para a pÃ¡gina do projeto -->
                  <a href={`${project.slug}/`}>
                    {project.data.title}
                  </a>
                </li>
              ))}
            </ul>
          </li>
        ))
      }
    </ul>
  </section>
</LayoutDefault>
